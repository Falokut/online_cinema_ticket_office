
events {}


http {
  upstream accounts-services {
    least_conn;
    server host.docker.internal:8000;
    server host.docker.internal:8001;
  }

  real_ip_header X-Forwarded-For;
  set_real_ip_from 0.0.0.0/0;

  ##
  # Logging Settings
  ##
  log_format specialLog '$remote_addr forwarded for $http_x_real_ip - $remote_user [$time_local] '
  '"$request" $status $body_bytes_sent '
  '"$http_referer" "$http_user_agent"';

  access_log /var/log/nginx/access-special.log specialLog;
  access_log /var/log/nginx/access.log;
  error_log /var/log/nginx/error.log;

  server {
    listen 80;
    location /api/accounts-service/ {
      proxy_pass 'http://accounts-services/';
      proxy_set_header X-Client-Ip $http_x_real_ip; 
    }
  }
}

